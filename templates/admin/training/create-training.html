{% extends 'layouts/admin_base.html' %}

{% block head %} 
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<style>
  #cover-spin {
      position:fixed;
      width:100%;
      left:0;right:0;top:0;bottom:0;
      background-color: rgba(255,255,255,0.7);
      z-index:9999;
      display:none;
  }
  
  @-webkit-keyframes spin {
      from {-webkit-transform:rotate(0deg);}
      to {-webkit-transform:rotate(360deg);}
  }
  
  @keyframes spin {
      from {transform:rotate(0deg);}
      to {transform:rotate(360deg);}
  }
  
  #cover-spin::after {
      content:'';
      display:block;
      position:absolute;
      left:48%;top:40%;
      width:40px;height:40px;
      border-style:solid;
      border-color:#ffc107;
      border-top-color:transparent;
      border-width: 4px;
      border-radius:50%;
      -webkit-animation: spin .8s linear infinite;
      animation: spin .8s linear infinite;
  }
</style>
<div id="cover-spin"></div>
<main id="main" class="main">
  <div class="pagetitle">
      <h1>Create Training</h1>
      <nav>
          <ol class="breadcrumb">
              <li class="breadcrumb-item">
                  <a >Training</a>
              </li>
              <li class="breadcrumb-item active">Create Training</li>
          </ol>
      </nav>
  </div>

  <section class="section dashboard">
    <div class="row">
        <!-- Left side columns -->
        <div class="col-lg-12">
            <div class="row">
                <!-- Recent Sales -->
                <div class="col-12">
                    <div class="card recent-sales overflow-auto">
                        <div class="filter">
                            <a class="icon" href="#" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                <li class="dropdown-header text-start">
                                    <h6>Filter</h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">Today</a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">This Month</a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">This Year</a>
                                </li>
                            </ul>
                        </div>

                        <!-- Modal HTML -->
                        <div id="myModal" class="modal fade">
                            <div class="modal-dialog modal-confirm">
                                <div class="modal-content">
                                    <div class="modal-header flex-column">
                                        <div class="icon-box">
                                            <i class="material-icons">&#xE5CD;</i>
                                        </div>
                                        <h4 class="modal-title w-100">Are you sure?</h4>
                                        <button
                                            type="button"
                                            class="close"
                                            data-dismiss="modal"
                                            aria-hidden="true"
                                        >
                                            &times;
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <p>
                                            Do you really want to delete these records? This process
            cannot be undone.
                                        </p>
                                    </div>
                                    <div class="modal-footer justify-content-center">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-danger">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Modal Html -->
                        
                        <div class="card-body">
                            <h5 class="card-title">Create Training
                            </h5>
                            <div id="create-body">
                              <form enctype="multipart/form-data" onsubmit="onCreateTraining(event)">
                                {% csrf_token %}
                                <div class="form-floating mb-3 mt-4">
                                    <input type="text" class="form-control" id="floatingTitle" placeholder="name@example.com">
                                    <label for="floatingInput">Title</label>
                                  </div>
                                  <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="floatingSummary" placeholder="">
                                    <label for="floatingSummary">Summary</label>
                                  </div>
                                  <div class="form-floating mb-3">
                                    <input type="number" step=".01" class="form-control" id="floatingPrice" placeholder="">
                                    <label for="floatingPrice">Price</label>
                                  </div>
                                  <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="floatingLink" placeholder="">
                                    <label for="floatingLink">Training Link</label>
                                  </div>
                                  <div class="form-floating mb-3">
                                    <!-- <input type="text" class="form-control" id="floatingDescription" placeholder=""> -->
                                    <textarea class="form-control" placeholder="Give a detailed description about this Training" id="floatingDescription" style="height: 300px;"></textarea>
                                    <label for="floatingDescription">Description</label>
                                  </div>
                                  <div class="form-floating mb-4">
                                    <input type="file" class="form-control" id="floatingImage" placeholder="" accept=".png, .jpg, .jpeg">
                                    <label for="floatingImage">Image</label>
                                  </div>

                                <div class="form-group mt-5 text-center">
                                  <!-- <button type="submit" class="btn btn-primary btn-lg" >Create</button> -->
                                  <button class="btn btn-primary btn-lg" type="submit" id="trainingSubmitBtn">
                                    <span class="" id="submitTextId">Create</span>
                                    <span hidden id="loadingIconId">
                                        <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                                        Loading...
                                    </span>
                                  </button>
                                </div>
                              </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Recent Sales -->
            </div>
        </div>
        <!-- End Left side columns -->
    </div>
</section>

</main>



<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    
function triggerSubmitIcon(){
    $("#trainingSubmitBtn").attr("disabled", "disabled")
    $("#submitTextId").attr("hidden", "hidden")
    $("#loadingIconId").removeAttr("hidden")
  }
  
  function disableTriggerSubmitIcon(){
    $("#trainingSubmitBtn").removeAttr("disabled")
    $("#submitTextId").removeAttr("hidden")
    $("#loadingIconId").attr("hidden", "hidden")
  }

  function setAllToNull(){
    $('#floatingTitle').val('');
    $('#floatingSummary').val('');
    $('#floatingPrice').val('');
    $('#floatingLink').val('');
    $('#floatingDescription').val('');
    $('#floatingImage').val('');
  }
  

    function onCreateTraining(event){
        event.preventDefault();

        triggerSubmitIcon()

        var formData = new FormData();
        formData.append('name', $('#floatingTitle').val());
        formData.append('summary', $('#floatingSummary').val());
        formData.append('price', $('#floatingPrice').val());
        formData.append('accessLink', $('#floatingLink').val());
        formData.append('description', $('#floatingDescription').val());
        formData.append('image', $('#floatingImage')[0].files[0]);
        formData.append('csrfmiddlewaretoken', jQuery("[name=csrfmiddlewaretoken]").val());

        let token = jQuery("[name=csrfmiddlewaretoken]").val();


        $.ajax({
            type: "POST",
            url: "{% url 'admin_training:create-training' %}",
            headers: {
                'X-CSRF-Token': token 
           },
            processData: false,
            contentType: false,
            mimeType: "multipart/form-data",
            data: formData,
            success: function (result) {        
            setAllToNull()
            disableTriggerSubmitIcon()
              result = JSON.parse(result)        
              result.message && Swal.fire(
                'Created!',
                `${result.message}`,
                'success'
              )
          
            },
                error: function (err) {
                  console.log(err)
                }
            });
            
    }
</script>

{% endblock %}