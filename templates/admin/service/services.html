{% extends 'layouts/admin_base.html' %}

{% block title %}
<title>Services</title>

{% endblock %}

{% block head %} 
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<style>
    #cover-spin {
        position:fixed;
        width:100%;
        left:0;right:0;top:0;bottom:0;
        background-color: rgba(255,255,255,0.7);
        z-index:9999;
        display:none;
    }
    
    @-webkit-keyframes spin {
        from {-webkit-transform:rotate(0deg);}
        to {-webkit-transform:rotate(360deg);}
    }
    
    @keyframes spin {
        from {transform:rotate(0deg);}
        to {transform:rotate(360deg);}
    }
    
    #cover-spin::after {
        content:'';
        display:block;
        position:absolute;
        left:48%;top:40%;
        width:40px;height:40px;
        border-style:solid;
        border-color:#ffc107;
        border-top-color:transparent;
        border-width: 4px;
        border-radius:50%;
        -webkit-animation: spin .8s linear infinite;
        animation: spin .8s linear infinite;
    }
</style>
<div id="cover-spin"></div>
<main id="main" class="main">
    <div class="pagetitle">
        <h1>Service</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a >Services</a>
                </li>
                <li class="breadcrumb-item active">Available Services</li>
            </ol>
        </nav>
    </div>
    <!-- End Page Title -->
    <section class="section dashboard">
        <div class="row">
            <!-- Left side columns -->
            <div class="col-lg-12">
                <div class="row">
                    <!-- Recent Sales -->
                    <div class="col-12">
                        <div class="card recent-sales overflow-auto">
                            <div class="filter">
                                <a class="icon" href="#" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                    <li class="dropdown-header text-start">
                                        <h6>Filter</h6>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">Today</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">This Month</a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">This Year</a>
                                    </li>
                                </ul>
                            </div>

                            <!-- Modal HTML -->
                            <div id="myModal" class="modal fade">
                                <div class="modal-dialog modal-confirm">
                                    <div class="modal-content">
                                        <div class="modal-header flex-column">
                                            <div class="icon-box">
                                                <i class="material-icons">&#xE5CD;</i>
                                            </div>
                                            <h4 class="modal-title w-100">Are you sure?</h4>
                                            <button
                                                type="button"
                                                class="close"
                                                data-dismiss="modal"
                                                aria-hidden="true"
                                            >
                                                &times;
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>
                                                Do you really want to delete these records? This process
                cannot be undone.
                                            </p>
                                        </div>
                                        <div class="modal-footer justify-content-center">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Cancel
                                            </button>
                                            <button type="button" class="btn btn-danger">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Modal Html -->
                            
                            <div class="card-body">
                                <h5 class="card-title">List of Services
                                </h5>
                                <div id="servicesId">
                                    {% include 'admin/service/_services-list.html' %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Recent Sales -->
                </div>
            </div>
            <!-- End Left side columns -->
        </div>
    </section>

  <div class="details" id="detailsId">

  </div>


</main>
<!-- End #main -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    
    function onGetServiceDetails(event, id){
        event.preventDefault();
    
        $.ajax({
            type: "GET",
            url: "/admin-user/service/get/"+id,
            success: function (result) {        
                $('#detailsId').html(result)
                    $('#serviceDetails').modal("show")      
            },
                error: function (err) {
                  console.log(err)
                }
            });          
      }

            
    const previewPhoto = () => {
        const input = document.getElementById('file-upload');
      const file = input.files;
      if (file) {
          const fileReader = new FileReader();
          const preview = document.getElementById('file-preview');
          fileReader.onload = function (event) {
              preview.setAttribute('src', event.target.result);
          }
          fileReader.readAsDataURL(file[0]);
      }
  }


  function onUpdateService(event){
    event.preventDefault();

    let image = document.getElementById("file-preview").src;
    image = image.split("base64,")[1]
    let token = jQuery("[name=csrfmiddlewaretoken]").val();


    var formData = new FormData();
    formData.append('Id', $('#trId').val());
    formData.append('name', $('#floatingTitleId').val());
    formData.append('summary', $('#floatingSummaryId').val());
    formData.append('price', $('#floatingPriceId').val());
    formData.append('description', $('#floatingDescriptionId').val());
    formData.append('image', image);
    formData.append('csrfmiddlewaretoken', token);


    $.ajax({
        type: "POST",
        url: "{% url 'admin_service:update-service-details' %}",
        headers: {
            'X-CSRF-Token': token 
       },
        processData: false,
        contentType: false,
        mimeType: "multipart/form-data",
        data: formData,
        success: function (result) {        
            //onCloseModal()
            $('#serviceDetails').modal('hide');
          result = JSON.parse(result)        
          result.message && Swal.fire(
            'Updated!',
            `${result.message}`,
            'success'
          )
      
        },
            error: function (err) {
              console.log(err)
            }
        });
        
  }


</script>
{% endblock %}
